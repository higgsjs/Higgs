Higgs
=====

Higgs JavaScript Virtual Machine

Interpreter and tracing JIT for JavaScript targetting x86-64 platforms.

**Requirements:**

- D compiler (DMD recommended)
- POSIX compliant OS (Linux, Unix, MacOS X)
- x86 64-bit CPU (if using the JIT compiler)
- Python 2.7 (if regenerating object layouts or instruction encodings)

**Quickstart:**

*Get the source:*
 
`git clone https://github.com/maximecb/Higgs.git && cd Higgs/source`

*You may wish to run the unit tests:*
 
`make test`
generates a binary `test-higgs` and tests its proper functioning.

*Compile a binary:*
 
`make all`
generates a binary `higgs` in the source directory.

*Install (optional):*
 
`make install` 
copies the `higgs` binary to `/usr/bin` and the runtime files to `/etc/higgs`.

*Cleanup:*

`make clean`
will remove any binaries in the source directory.

For further info, see the `makefile`.

**Usage:**

`higgs` will start Higgs and give you a REPL (read-eval-print loop).

To execute one or more files, pass them to `higgs`:

`higgs file1.js file2.js`

The `--e` option accepts a string to execute:

`higgs --e "var x = 4; x = x + 5; print(x)"`

The `--repl` option will start a REPL after evaluating a string and/or files:

`higgs --repl file1.js` will evaluate `file1.js` and then start a REPL.

`higgs file1.js` will evaluate `file1.js` and then exit.

The `--jit_disable` option will disable the JIT compiler and rely solely on the interpreter.

The `--jit_dumpasm` option will dump the assembler code generated by the JIT to the console.

**Notes:**
 - You may wish to use `rlwrap` for a better REPL experience.

Libraries
=====

**stdio:**

Higgs has a library to provide common I/O functionality. It is based on (and is actually a wrapper around)
the C I/O functions found in [the standard library](http://www.cplusplus.com/reference/cstdio/).

*Importing:*
```JS
// To use the I/O functions you must first import the stdio module:
var io = require('lib/stdio');
```

*File operations:*
```JS

// The stdio module provides some common file operations

// Delete a file, returns true if successful or false otherwise
io.remove('test.txt');

// Rename a file, returns true if successful or false otherwise
io.rename('foo.txt', 'bar.txt');

// Get a temporary file, returns a File object on success or throws error on failure
var myfile = io.tmpfile();

// Get a unique name, returns a string containing the name on success or throws error on failure
var name = io.tmpname();


// Open a file, returns a File object on success or throws error on failure
// open foo.txt for reading
var foo = io.fopen("foo.txt", "r");
```

*File Objects:*
```JS
// Some functions like fopen return an instance of File:
var myfile = io.fopen("foo.txt", "w+");

// File objects provide methods for reading, writing, etc

// Get a character, will return "" for EOF
var c = myfile.getc();

// Read a line, including newline
var line = myfile.readLine();

// You can also specify a maximum length to read
// the next read will get the remainder (if any of the line)
var first_ten_chars = myfile.readLine(10);
var remainder = myfile.readLine();

// Read the next x chars
var ten_chars = myfile.read(10);

// Read the entire file
var test = myfile.read();

// Write a char to the file, returns true if successful or false otherwise
myfile.putc("H");

// Write a string to the file, returns true if successful or false otherwise
myfile.write("Hello World.");

// Flush a file, returns true if successful or false otherwise
myfile.flush();

// Returns true if the next character is EOF
myfile.EOF();

// Returns the current position in the file
myfile.tell();

// Rewind to beginning of file
myfile.rewind();

/*
Seek to a given character. You can optionally provide an origin
Valid origins:
io.SEEK_SET - absolute position (default)
io.SEEK_CUR - current position
*/

// Seek to 10th character
myfile.seek(10);

// Seek 2 characters ahead
myfile.seek(2, io.SEEK_CUR);

// When finished with a file close() will close it and free some resources
myfile.close();
```
*stdin/stdout/stderr:*
```JS
// The stdio module provides File objects for stdin/stdout/stderr

// Get a char from stdin
io.stdin.getc();

// Write to stdout
io.stdout.write("Hello!");

// Write to stderr
io.stderr.write("Hello!");
```


**Notes:**
 - There is currently no support in stdio for wchar functions.
 - Functions in the stdio library must be called in the context of the stdio module.
`var fopen = io.fopen` will not work.

